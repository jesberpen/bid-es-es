{"name":"Generador de aprietos","type":"script","author":"gqbh3f5j2JvfepnF","img":"icons/magic/nature/root-vines-entwined-leaves.webp","scope":"global","command":"const tableHeatA = 'Aprietos - Riesgo 0-3';  // Entanglements - Heat 0-3\nconst tableHeatB = 'Aprietos - Riesgo 4/5';  // Entanglements - Heat 4/5\nconst tableHeatC = 'Aprietos - Riesgo 6+';   // Entanglements - Heat 6+\nconst compendiumTables = 'Tablas de aprietos';       // Compendium name \nconst version = '1.2';\nmain();\n\n/*\nTODO\n- replace text by journal\n\noriginal source: https://raw.githubusercontent.com/brunocalado/mestre-digital/master/Foundry%20VTT/Macros/Forged%20in%20the%20Dark/bid-entanglement.js\ncontributors: brunocalado, LebombJames\ntranslation to spanish: SirJBP\nicon: icons/magic/nature/root-vines-entwined-leaves.webp\n*/\n  \nasync function main() {\n  \n  playersNames = game.actors.contents.filter((t) => t.data.type === \"crew\").map((p=> p.data.name)); \n\n  let playerNameList;\n\n  playersNames.map((el) => {      \n    playerNameList += `<option value=\"${el}\">${el}</option>`;      \n  });  \n  \n  new Dialog({\n    title: `Aprietos - v${version}`,\n    content: `\n    <h2>Banda</h2>\n    <p><select id=\"playerName\" style=\"width: 100%\">${playerNameList}</select></p>\n    <br>\n    <p>\n      <input type=\"checkbox\" id=\"whisper\" checked/> ¿Susurrar?\n    </p>\n    `,\n    buttons: {\n      roll: {\n        label: \"Tirar\",\n        callback: (html) => {\n          createImageFolder(html);\n        }\n      }, \n      cancel: {\n        label: \"Cancelar\"\n      }\n    }\n  }).render(true)\n}\n\nasync function createImageFolder(html) {\n  let playerName = html.find(\"#playerName\")[0].value;\n  let whisper = html.find(\"#whisper\")[0].checked;\n\n  let crew = game.actors.getName(playerName).data.data;\n  let crewHeat = parseInt(crew.heat);\n  let crewWanted = parseInt(crew.wanted);\n\n  let entanglementToUse = '';\n\n  switch (crewHeat) {\n    case 0:\n    case 1:\n    case 2:\n    case 3:\n      entanglementToUse = await drawFromTable(tableHeatA, compendiumTables) \n    break\n    case 4:\n    case 5:\n      entanglementToUse = await drawFromTable(tableHeatB, compendiumTables) \n    break\n    case 6:\n    case 7:\n    case 8:\n    case 9:\n      entanglementToUse = await drawFromTable(tableHeatC, compendiumTables) \n  }\n\n  let rollFormula = `${crewWanted}d6`;\n  if (rollFormula === \"0d6\") {\n    rollFormula = \"2d6kl1\";\n  }\n\n  entanglementToUse.data.formula = rollFormula;\n  \n  if (whisper) {\n    entanglementToUse.draw({rollMode: 'gmroll'});\n  } else {\n    entanglementToUse.draw();\n  }  \n}\n\nasync function drawFromTable(tableName, compendiumName) {\n  let list_compendium = await game.packs.filter(p=>p.documentName=='RollTable');      \n  let inside = await list_compendium.filter( p=>p.metadata.label==compendiumName )[0].getDocuments();      \n  let table = await inside.filter( p=>p.data['name']==tableName )[0];\n  \n  if (!table) {\n    ui.notifications.warn(`Tabla ${tableName} no encontrada.`, {});\n    return;\n  }\n  return await table;\n}","folder":null,"sort":0,"permission":{"default":0,"thWDvNEhl7M3mC2d":3,"gqbh3f5j2JvfepnF":3},"flags":{"core":{"sourceId":"Macro.nlsTrxhKZxLIqHWD"}},"_id":"KARdYfCZrxjEv9LQ"}
{"name":"Oracle Image Generator","type":"script","author":"gqbh3f5j2JvfepnF","img":"icons/svg/book.svg","scope":"global","command":"/*\nEN:\nTo play solo or coop with Alone in the Dark rules.\nThis macro generates a random image in the chat from a folder in your world\nTo use replace \"IMAGE FOLDER\" with the folder where you keep your icons (e.g: worlds/bitdcoop/GamesIconLib)\nRecommended to use icons from https://game-icons.net/\n\nES:\nPara jugar en solitario o coperativo usando las reglas de Alone in the Dark.\nEsta macro escribe en el chat una imagen de forma aleatoria de una colección en un archivo de tu mundo\nPara usar cambiar \"IMAGE FOLDER\" con la ruta al archivo donde están las imágenes (p.e: worlds/bitdcoop/GamesIconLib)\nRecomiendo usar los iconos de https://game-icons.net/\n\nauthor: SirJBP (with help from a user in Foundry discord!)\n*/\n\nlet imageList = await FilePicker.browse(\"data\",\"IMAGE FOLDER\");\nlet images = imageList.files.filter(s => s.includes(\".png\") || s.includes(\".webp\") || s.includes(\".jpg\") || s.includes(\".svg\"));\nconst content = `<img src=\"${images[Math.floor(Math.random() * images.length)]}\" viewBox=\"0 0 100 100\" width=\"100\" height=\"100\">`;\n\n// If you want the image to be seen by GM only uncomment first line and comment the second one. Si quieres que la imagen sea solo visible por el DJ quite las lineas de comentario de la primera linea y añadelas a la segunda.\n\n// ChatMessage.create({content, whisper: ChatMessage.getWhisperRecipients(\"GM\")})\nChatMessage.create({content})","folder":null,"sort":0,"permission":{"default":0,"gqbh3f5j2JvfepnF":3},"flags":{"core":{"sourceId":"Macro.pdhXGRwBzjpsw2Gs"}},"_id":"2EmvupYIhCOQxahQ"}
